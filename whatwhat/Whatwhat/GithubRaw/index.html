<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>GithubRaw (whatwhat.Whatwhat.GithubRaw)</title><link rel="stylesheet" href="../../../_odoc_support/odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 2.2.0"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../_odoc_support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../index.html">whatwhat</a> &#x00BB; <a href="../index.html">Whatwhat</a> &#x00BB; GithubRaw</nav><header class="odoc-preamble"><h1>Module <code><span>Whatwhat.GithubRaw</span></code></h1><p><code>GithubRaw</code> queries the GitHub GraphQL and REST APIs for data about issues, users, and project boards, and parses that into OCaml records.</p></header><nav class="odoc-toc"><ul><li><a href="#http-requests">HTTP requests</a></li><li><a href="#people">People</a></li><li><a href="#issues">Issues</a></li><li><a href="#columns">Columns</a></li><li><a href="#projects">Projects</a></li></ul></nav><div class="odoc-content"><h2 id="http-requests"><a href="#http-requests" class="anchor"></a>HTTP requests</h2><div class="odoc-spec"><div class="spec type anchored" id="type-http_method"><a href="#type-http_method" class="anchor"></a><code><span><span class="keyword">type</span> http_method</span><span> = </span></code><ol><li id="type-http_method.GET" class="def variant constructor anchored"><a href="#type-http_method.GET" class="anchor"></a><code><span>| </span><span><span class="constructor">GET</span></span></code></li><li id="type-http_method.POST" class="def variant constructor anchored"><a href="#type-http_method.POST" class="anchor"></a><code><span>| </span><span><span class="constructor">POST</span></span></code></li><li id="type-http_method.PUT" class="def variant constructor anchored"><a href="#type-http_method.PUT" class="anchor"></a><code><span>| </span><span><span class="constructor">PUT</span></span></code></li><li id="type-http_method.DELETE" class="def variant constructor anchored"><a href="#type-http_method.DELETE" class="anchor"></a><code><span>| </span><span><span class="constructor">DELETE</span></span></code></li></ol></div><div class="spec-doc"><p>HTTP methods. Only <code>GET</code>, <code>POST</code>, <code>PUT</code>, and <code>DELETE</code> are supported within <code>whatwhat</code> (for now).</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-run_github_query_async"><a href="#val-run_github_query_async" class="anchor"></a><code><span><span class="keyword">val</span> run_github_query_async : 
  <span>?as_bot:bool <span class="arrow">&#45;&gt;</span></span>
  <span>?http_method:<a href="#type-http_method">http_method</a> <span class="arrow">&#45;&gt;</span></span>
  <span>?params:<span><span>(string * <span>string list</span>)</span> list</span> <span class="arrow">&#45;&gt;</span></span>
  <span>?body:string <span class="arrow">&#45;&gt;</span></span>
  <span>string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="xref-unresolved">Yojson</span>.Basic.t <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p>Run a GitHub query, returning a promise for the body JSON.</p><ul><li><code>as_bot</code> defaults to <code>false</code>. Set this to <code>true</code> if you want to interact as the GitHub bot account (this requires that you have a token set up in your secrets file).</li><li><code>params</code> are URL-encoded parameters.</li><li><code>body</code> is the request body (used only for <code>POST</code>, <code>PUT</code>, and <code>DELETE</code> requests).</li><li>The mandatory argument is the URI.</li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-run_github_query"><a href="#val-run_github_query" class="anchor"></a><code><span><span class="keyword">val</span> run_github_query : 
  <span>?as_bot:bool <span class="arrow">&#45;&gt;</span></span>
  <span>?http_method:<a href="#type-http_method">http_method</a> <span class="arrow">&#45;&gt;</span></span>
  <span>?params:<span><span>(string * <span>string list</span>)</span> list</span> <span class="arrow">&#45;&gt;</span></span>
  <span>?body:string <span class="arrow">&#45;&gt;</span></span>
  <span>string <span class="arrow">&#45;&gt;</span></span>
  <span class="xref-unresolved">Yojson</span>.Basic.t</span></code></div><div class="spec-doc"><p>Run a GitHub query, returning the body JSON directly. All arguments are the same as in <a href="#val-run_github_query_async"><code>run_github_query_async</code></a>.</p></div></div><h2 id="people"><a href="#people" class="anchor"></a>People</h2><div class="odoc-spec"><div class="spec type anchored" id="type-person"><a href="#type-person" class="anchor"></a><code><span><span class="keyword">type</span> person</span><span> = </span><span>{</span></code><ol><li id="type-person.login" class="def record field anchored"><a href="#type-person.login" class="anchor"></a><code><span>login : string;</span></code></li><li id="type-person.name" class="def record field anchored"><a href="#type-person.name" class="anchor"></a><code><span>name : <span>string option</span>;</span></code></li><li id="type-person.email" class="def record field anchored"><a href="#type-person.email" class="anchor"></a><code><span>email : <span>string option</span>;</span></code></li></ol><code><span>}</span></code></div><div class="spec-doc"><p>A <code>person</code> is a GitHub user: they are identified by their login username, a real name, and an email. The latter two are obtained from their public profile (not their commits) and may be absent.</p><p>In general, we would like to have an external lookup of GitHub usernames to real names as this would allow for foolproof matching of Forecast and GitHub accounts. See <a href="https://github.com/alan-turing-institute/whatwhat/issues/70">#70</a>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-get_all_users_async"><a href="#val-get_all_users_async" class="anchor"></a><code><span><span class="keyword">val</span> get_all_users_async : <span><span><a href="#type-person">person</a> list</span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>get_all_users_async</code> is a promise which returns a list of all users who can be assigned to issues in the repository, which essentially means anybody who can view the repository.</p></div></div><h2 id="issues"><a href="#issues" class="anchor"></a>Issues</h2><p>Each issue on the GitHub project tracker nominally refers to a project within REG.</p><div class="odoc-spec"><div class="spec type anchored" id="type-issue_state"><a href="#type-issue_state" class="anchor"></a><code><span><span class="keyword">type</span> issue_state</span><span> = </span></code><ol><li id="type-issue_state.Open" class="def variant constructor anchored"><a href="#type-issue_state.Open" class="anchor"></a><code><span>| </span><span><span class="constructor">Open</span></span></code></li><li id="type-issue_state.Closed" class="def variant constructor anchored"><a href="#type-issue_state.Closed" class="anchor"></a><code><span>| </span><span><span class="constructor">Closed</span></span></code></li></ol></div><div class="spec-doc"><p>The state of an issue on GitHub.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-pp_issue_state"><a href="#val-pp_issue_state" class="anchor"></a><code><span><span class="keyword">val</span> pp_issue_state : 
  <span><span class="xref-unresolved">Ppx_deriving_runtime</span>.Format.formatter <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-issue_state">issue_state</a> <span class="arrow">&#45;&gt;</span></span>
  <span class="xref-unresolved">Ppx_deriving_runtime</span>.unit</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-show_issue_state"><a href="#val-show_issue_state" class="anchor"></a><code><span><span class="keyword">val</span> show_issue_state : <span><a href="#type-issue_state">issue_state</a> <span class="arrow">&#45;&gt;</span></span> <span class="xref-unresolved">Ppx_deriving_runtime</span>.string</span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-issue"><a href="#type-issue" class="anchor"></a><code><span><span class="keyword">type</span> issue</span><span> = </span><span>{</span></code><ol><li id="type-issue.number" class="def record field anchored"><a href="#type-issue.number" class="anchor"></a><code><span>number : int;</span></code></li><li id="type-issue.title" class="def record field anchored"><a href="#type-issue.title" class="anchor"></a><code><span>title : string;</span></code></li><li id="type-issue.body" class="def record field anchored"><a href="#type-issue.body" class="anchor"></a><code><span>body : string;</span></code></li><li id="type-issue.state" class="def record field anchored"><a href="#type-issue.state" class="anchor"></a><code><span>state : <a href="#type-issue_state">issue_state</a>;</span></code></li><li id="type-issue.assignees" class="def record field anchored"><a href="#type-issue.assignees" class="anchor"></a><code><span>assignees : <span><a href="#type-person">person</a> list</span>;</span></code></li><li id="type-issue.labels" class="def record field anchored"><a href="#type-issue.labels" class="anchor"></a><code><span>labels : <span>string list</span>;</span></code></li></ol><code><span>}</span></code></div><div class="spec-doc"><p>An <code>issue</code> is a GitHub issue on the repository being queried.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-issue_r"><a href="#type-issue_r" class="anchor"></a><code><span><span class="keyword">type</span> issue_r</span><span> = </span><span>{</span></code><ol><li id="type-issue_r.issue" class="def record field anchored"><a href="#type-issue_r.issue" class="anchor"></a><code><span>issue : <a href="#type-issue">issue</a>;</span></code></li><li id="type-issue_r.reactions" class="def record field anchored"><a href="#type-issue_r.reactions" class="anchor"></a><code><span>reactions : <span><span>(string * <a href="#type-person">person</a>)</span> list</span>;</span></code></li></ol><code><span>}</span></code></div><div class="spec-doc"><p>A GitHub issue, but with reactions. We have a separate type for this because fetching reactions is a separate request to the GitHub API, and we don't want to indiscriminately do this.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-get_issue"><a href="#val-get_issue" class="anchor"></a><code><span><span class="keyword">val</span> get_issue : <span>int <span class="arrow">&#45;&gt;</span></span> <a href="#type-issue">issue</a></span></code></div><div class="spec-doc"><p>Fetch a numbered issue from GitHub.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-get_issue_r"><a href="#val-get_issue_r" class="anchor"></a><code><span><span class="keyword">val</span> get_issue_r : <span>int <span class="arrow">&#45;&gt;</span></span> <a href="#type-issue_r">issue_r</a></span></code></div><div class="spec-doc"><p>Fetch a numbered issue from GitHub, together with its reactions.</p></div></div><h2 id="columns"><a href="#columns" class="anchor"></a>Columns</h2><p>A <code>column</code> refers to a column within a project board on GitHub.</p><p>There are several forms of columns, in order to deal with the fact that different parts of <code>whatwhat</code> require different requirements for data. There are at least three possibilities:</p><ol><li>Only the numbers of issues in a column are required. (For example, to determine whether an issue is in a column.)</li><li>The issues themselves are needed, but not the reactions. (This is the most common.)</li><li>All issues and reactions are needed. (This is required if we want to collate all reactions from a specific person.)</li></ol><p>In order to ensure that functions can be called in a type-safe manner, these three classes of columns are respectively represented by the <code>column_n</code> ('numbers'), <code>column</code>, and <code>column_r</code> ('reactions') record types.</p><div class="odoc-spec"><div class="spec type anchored" id="type-column_n"><a href="#type-column_n" class="anchor"></a><code><span><span class="keyword">type</span> column_n</span><span> = </span><span>{</span></code><ol><li id="type-column_n.name" class="def record field anchored"><a href="#type-column_n.name" class="anchor"></a><code><span>name : string;</span></code></li><li id="type-column_n.id" class="def record field anchored"><a href="#type-column_n.id" class="anchor"></a><code><span>id : int;</span></code></li><li id="type-column_n.issues_n" class="def record field anchored"><a href="#type-column_n.issues_n" class="anchor"></a><code><span>issues_n : <span>int list</span>;</span></code></li></ol><code><span>}</span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-column"><a href="#type-column" class="anchor"></a><code><span><span class="keyword">type</span> column</span><span> = </span><span>{</span></code><ol><li id="type-column.name" class="def record field anchored"><a href="#type-column.name" class="anchor"></a><code><span>name : string;</span></code></li><li id="type-column.id" class="def record field anchored"><a href="#type-column.id" class="anchor"></a><code><span>id : int;</span></code></li><li id="type-column.issues" class="def record field anchored"><a href="#type-column.issues" class="anchor"></a><code><span>issues : <span><a href="#type-issue">issue</a> list</span>;</span></code></li></ol><code><span>}</span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-column_r"><a href="#type-column_r" class="anchor"></a><code><span><span class="keyword">type</span> column_r</span><span> = </span><span>{</span></code><ol><li id="type-column_r.name" class="def record field anchored"><a href="#type-column_r.name" class="anchor"></a><code><span>name : string;</span></code></li><li id="type-column_r.id" class="def record field anchored"><a href="#type-column_r.id" class="anchor"></a><code><span>id : int;</span></code></li><li id="type-column_r.issues_r" class="def record field anchored"><a href="#type-column_r.issues_r" class="anchor"></a><code><span>issues_r : <span><a href="#type-issue_r">issue_r</a> list</span>;</span></code></li></ol><code><span>}</span></code></div></div><h2 id="projects"><a href="#projects" class="anchor"></a>Projects</h2><p>A <code>project</code> refers to a project board on GitHub, which contains a list of columns. For similar reasons as described for columns, there are three record types: <code>project_n</code>, <code>project</code>, and <code>project_r</code>, each with the same meaning as above.</p><div class="odoc-spec"><div class="spec type anchored" id="type-project_n"><a href="#type-project_n" class="anchor"></a><code><span><span class="keyword">type</span> project_n</span><span> = </span><span>{</span></code><ol><li id="type-project_n.id" class="def record field anchored"><a href="#type-project_n.id" class="anchor"></a><code><span>id : int;</span></code></li><li id="type-project_n.name" class="def record field anchored"><a href="#type-project_n.name" class="anchor"></a><code><span>name : string;</span></code></li><li id="type-project_n.columns_n" class="def record field anchored"><a href="#type-project_n.columns_n" class="anchor"></a><code><span>columns_n : <span><a href="#type-column_n">column_n</a> list</span>;</span></code></li></ol><code><span>}</span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-project"><a href="#type-project" class="anchor"></a><code><span><span class="keyword">type</span> project</span><span> = </span><span>{</span></code><ol><li id="type-project.id" class="def record field anchored"><a href="#type-project.id" class="anchor"></a><code><span>id : int;</span></code></li><li id="type-project.name" class="def record field anchored"><a href="#type-project.name" class="anchor"></a><code><span>name : string;</span></code></li><li id="type-project.columns" class="def record field anchored"><a href="#type-project.columns" class="anchor"></a><code><span>columns : <span><a href="#type-column">column</a> list</span>;</span></code></li></ol><code><span>}</span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-project_r"><a href="#type-project_r" class="anchor"></a><code><span><span class="keyword">type</span> project_r</span><span> = </span><span>{</span></code><ol><li id="type-project_r.id" class="def record field anchored"><a href="#type-project_r.id" class="anchor"></a><code><span>id : int;</span></code></li><li id="type-project_r.name" class="def record field anchored"><a href="#type-project_r.name" class="anchor"></a><code><span>name : string;</span></code></li><li id="type-project_r.columns_r" class="def record field anchored"><a href="#type-project_r.columns_r" class="anchor"></a><code><span>columns_r : <span><a href="#type-column_r">column_r</a> list</span>;</span></code></li></ol><code><span>}</span></code></div></div><p>The following three functions retrieve entire <code>projects</code> from GitHub with the required level of detail. The exact project being fetched is determined by the variables in the <code>whatwhat</code> configuration file.</p><div class="odoc-spec"><div class="spec value anchored" id="val-get_project_n"><a href="#val-get_project_n" class="anchor"></a><code><span><span class="keyword">val</span> get_project_n : <span>unit <span class="arrow">&#45;&gt;</span></span> <a href="#type-project_n">project_n</a></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-get_project"><a href="#val-get_project" class="anchor"></a><code><span><span class="keyword">val</span> get_project : <span>unit <span class="arrow">&#45;&gt;</span></span> <a href="#type-project">project</a></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-get_project_r"><a href="#val-get_project_r" class="anchor"></a><code><span><span class="keyword">val</span> get_project_r : <span>unit <span class="arrow">&#45;&gt;</span></span> <a href="#type-project_r">project_r</a></span></code></div></div></div></body></html>